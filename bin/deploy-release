#!/usr/bin/env bash 

set -e

APP_NAME=correcthorse_main

instance_ip=`cat deploy/instance_ip | tr -d '\n'`
target="ubuntu@$instance_ip"
tar="$APP_NAME.tar.gz"


remote_ex(){
    echo ssh $target $1
    ssh $target $1
}

scp "deploy/release/$tar" "$target":

remote_ex "sudo service $APP_NAME stop; echo 'matey'"
remote_ex "rm -rf app"
remote_ex "mkdir -p app"
remote_ex "cd app && tar zxvf ../$tar"
remote_ex "sudo service $APP_NAME start"


